from hydromt_fiat.fiat import FiatModel
from hydromt.log import setuplog
from pathlib import Path
import pytest
import shutil
import geopandas as gpd

EXAMPLEDIR = Path(
    "P:/11207949-dhs-phaseii-floodadapt/Model-builder/Delft-FIAT/local_test_database"
)

_cases = {
    "csvs": {
        "dir": "test_csvs",
        "configuration": {
            "setup_vulnerability_from_csv": {
                "csv_fn": "c:/Users/groen_fe/OneDrive - Stichting Deltares/1_Projects/DHS/fiat_modified/Damage Functions",
                "unit": "feet",
            },
        },
    }
}


@pytest.mark.parametrize("case", list(_cases.keys()))
def test_csvs(case):
    # Read model in examples folder.
    root = EXAMPLEDIR.joinpath(_cases[case]["dir"])
    if root.exists():
        shutil.rmtree(root)

    logger = setuplog("hydromt_fiat", log_level=10)

    fm = FiatModel(root=root, mode="w", logger=logger)
    fm.build(opt=_cases[case]["configuration"])
    fm.write()
